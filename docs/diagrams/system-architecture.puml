@startuml System Architecture
!theme plain
skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle

package "Data Processing Framework" {
    
    package "User Pipeline Modules" as UserPipelines {
        component [*_pipeline.py] as PipelineModules
        note right of PipelineModules : Auto-discovered\npipeline modules
    }
    
    package "Core Framework" as CoreFramework {
        component [Configuration\nSystem] as Config
        component [Logging\nSystem] as Logging
        component [Pipeline\nDiscovery] as Discovery
        component [Cron\nManager] as CronManager
    }
    
    package "Pipeline Tools" as PipelineTools {
        package "Extractors" as Extractors {
            component [HTTP\nExtractor] as HttpExt
            component [ClickHouse\nExtractor] as ChExt
            component [Metabase\nExtractor] as MetabaseExt
        }
        
        package "Transformers" as Transformers {
            component [Lambda\nTransformer] as LambdaTrans
            component [Type\nConverter] as TypeTrans
            component [Column\nTransformer] as ColTrans
        }
        
        package "Loaders" as Loaders {
            component [ClickHouse\nLoader] as ChLoader
            component [Console\nLoader] as ConsoleLoader
            component [File\nLoader] as FileLoader
        }
    }
    
    package "Operations & Deployment" as Operations {
        component [Migration\nSystem] as Migrations
        component [8-Step\nDeployment] as Deploy
        component [Testing\nFramework] as Testing
        component [Backfill\nManager] as Backfill
        component [Production\nIntegrity] as Integrity
    }
}

' External Systems
cloud "External APIs" as ExternalAPIs {
    component [REST APIs] as RestAPIs
    component [Data Sources] as DataSources
}

cloud "Metabase" as Metabase {
    component [API] as MetabaseAPI
    component [Database\nConnections] as MetabaseDB
    component [Query\nEngine] as QueryEngine
}

database "ClickHouse Database" as ClickHouse {
    component [Tables] as Tables
    component [Schema] as Schema
    component [data_warehouse] as DataWarehouse
}

node "Production Server" as Server {
    component [Cron Jobs] as CronJobs
    component [Processes] as Processes
    component [Logs] as Logs
    component [Virtual\nEnvironment] as Venv
}

' Connections
UserPipelines --> CoreFramework : registers with
CoreFramework --> PipelineTools : uses
PipelineTools --> Operations : managed by
Operations --> Server : deploys to

PipelineTools --> ExternalAPIs : extracts from
PipelineTools --> ClickHouse : loads to
PipelineTools --> Metabase : extracts from
CoreFramework --> Server : schedules on

Operations --> ClickHouse : validates connectivity
Operations --> Metabase : validates integration
Operations --> Server : verifies deployment

@enduml